"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Event_1 = require("./common/Event");
const execute_1 = require("./common/execute");
class FallbackPolicy {
    constructor(options, value) {
        this.options = options;
        this.value = value;
        this.fallbackEmitter = new Event_1.EventEmitter();
        /**
         * Event that fires when a fallback happens.
         */
        // tslint:disable-next-line: member-ordering
        this.onFallback = this.fallbackEmitter.addListener;
    }
    /**
     * Executes the given function.
     * @param fn -- Function to execute.
     * @returns The function result or fallback value.
     */
    async execute(fn) {
        const result = await execute_1.execute(this.options, fn);
        if ('success' in result) {
            return result.success;
        }
        this.fallbackEmitter.emit(result);
        return this.value();
    }
}
exports.FallbackPolicy = FallbackPolicy;
//# sourceMappingURL=FallbackPolicy.js.map