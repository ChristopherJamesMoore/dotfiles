"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const chai_1 = require("chai");
const sinon_1 = require("sinon");
const Policy_1 = require("./Policy");
describe('FallbackPolicy', () => {
    it('does not fall back when not necessary', async () => {
        const result = await Policy_1.Policy.handleAll()
            .fallback('error')
            .execute(() => 'ok');
        chai_1.expect(result).to.equal('ok');
    });
    it('returns a fallback and emits an error if necessary', async () => {
        const policy = await Policy_1.Policy.handleAll().fallback('error');
        const onFallback = sinon_1.stub();
        policy.onFallback(onFallback);
        const error = new Error('oh no!');
        const result = await policy.execute(() => {
            throw error;
        });
        chai_1.expect(result).to.equal('error');
        chai_1.expect(onFallback).calledWith({ error });
    });
});
//# sourceMappingURL=FallbackPolicy.test.js.map